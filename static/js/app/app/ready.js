// Generated by CoffeeScript 1.6.3
define(['app/floyd'], function(floyd) {
  var canvas, ctx, ditherPixel, height, loadImage, process, quantizePixel, s, src, width;
  loadImage = floyd.loadImage, ditherPixel = floyd.ditherPixel, quantizePixel = floyd.quantizePixel, process = floyd.process;
  canvas = document.getElementById('canvas');
  ctx = canvas.getContext('2d');
  width = canvas.width, height = canvas.height;
  console.log('[info] loading image');
  if (location.hash) {
    s = location.hash.slice(1);
    src = "img/" + s;
  } else {
    src = 'img/cooldog.png';
  }
  loadImage(ctx, src, 0, 0, function() {
    var bits, imageData, proc;
    console.log('[info] loaded image');
    console.log('[info] grabbing imageData');
    imageData = ctx.getImageData(0, 0, width / 2, height);
    console.log('[info] about to dither');
    bits = 2;
    proc = ditherPixel;
    imageData = process(imageData, bits, proc);
    console.log('[info] done dithering');
    console.log('[info] about to draw imageData');
    return ctx.putImageData(imageData, width / 2, 0);
  });
  return loadImage(ctx, src, onload);
});
